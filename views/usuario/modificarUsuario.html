<!DOCTYPE html>
<div layout="row"
     layout-align="center"
     layout-xs="row">
    <div class="distribucion-panel" 
         flex-lg="60"
         flex-md="90"
         layout="column"
         layout-xs="column"
         ng-show="user.username" 
         data-ng-init="detailUsuario()">
        <div ng-cloak>
            <!-- JUEGO DE TABS MODIFICAR USUARIO-->
            <md-content md-theme="docs-dark" style="min-height: 598px;">
                <md-tabs md-dynamic-height md-border-bottom
                         md-no-ink-bar="false"
                         md-stretch-tabs="always"
                         md-center-tabs="true"
                         md-selected="tabs">
                    <!-- TAB MODIFICAR USUARIO-->
                    <md-tab label="Perfil de {{user.username}}">
                        <md-content class="md-padding">
                            <div class="col-lg-2"></div>
                            <div layout="column" ng-cloak class="col-lg-8">
                                <!-- FORMULARIO MODIFICAR DATOS USUARIO-->
                                <form name="changePerfil">
                                    <!-- INPUT NOMBRE-->
                                    <md-input-container class="md-icon md-block">
                                        <label>Nombre</label>
                                        <md-icon class="material-icons">&#xE8A6;</md-icon>
                                        <input minlength="4"
                                               md-maxlength="20"
                                               maxlength="25"
                                               ng-model="user.nombre" md-no-asterisk
                                               name="nombre" required placeholder="Nombre"/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePerfil.nombre.$error"
                                             ng-if='changePerfil.nombre.$dirty || changePerfil.nombre.$touched'>
                                            <div ng-message="minlength">Nombre demasiado corto.</div>
                                            <div ng-message="md-maxlength">Nombre demasiado largo.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>
                                        </div>
                                    </md-input-container><!--FIN INPUT NOMBRE-->
                                    <!-- INPUT APELLIDO-->
                                    <md-input-container class="md-icon md-block">
                                        <label>Apellido</label>
                                        <md-icon class="material-icons">&#xE8A6;</md-icon>
                                        <!-- INPUT APELLIDO-->
                                        <input type="text" 
                                               minlength="4" 
                                               md-maxlength="20"
                                               maxlength="25"
                                               placeholder="Apellido" md-no-asterisk
                                               ng-model="user.apellido" name="apellido" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePerfil.apellido.$error"
                                             ng-if='changePerfil.apellido.$dirty || changePerfil.apellido.$touched'>
                                            <div ng-message="minlength">Apellido demasiado corto.</div>
                                            <div ng-message="md-maxlength">Apellido demasiado largo.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>
                                        </div>
                                    </md-input-container><!--FIN INPUT APELLIDO-->
                                    <!-- INPUT DNI-->
                                    <md-input-container class="md-icon md-block">
                                        <!-- LABEL DNI-->
                                        <label>D.N.I.</label>
                                        <md-icon class="material-icons">&#xE90D;</md-icon>
                                        <!-- INPUT DNI-->
                                        <input type="text" 
                                               minlength="4" 
                                               md-maxlength="8"
                                               maxlength="8"
                                               placeholder="D.N.I."
                                               ng-model="user.dni" name="dni" required/>
                                        <!-- MENSAJES -->
                                        <div ng-messages="changePerfil.dni.$error"
                                             ng-if='changePerfil.dni.$dirty || changePerfil.dni.$touched'>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container><!-- FIN DNI-->
                                    <!--INPUT DOMICILIO -->
                                    <md-input-container class="md-icon md-block">
                                        <!-- LABEL DOMICILIO-->
                                        <label>Domicilio</label>
                                        <md-icon class="material-icons">&#xE88A;</md-icon>
                                        <!-- INPUT DOMICILIO-->
                                        <input type="text"
                                               minlength="8" 
                                               md-maxlength="25"
                                               placeholder="Domicilio" md-no-asterisk
                                               ng-model="user.domicilio" name="domicilio" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePerfil.domicilio.$error"
                                             ng-if='changePerfil.domicilio.$dirty || changePerfil.domicilio.$touched'>
                                            <div ng-message="minlength">Dirección de domicilio demasiado corta.</div>
                                            <div ng-message="md-maxlength">Dirección de domicilio demasiado larga.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container><!-- FIN INPUT DOMICILIO-->                                        
                                    <!-- INPUT EMAIL-->
                                    <md-input-container class="md-icon md-block">
                                        <!-- LABEL EMAIL-->
                                        <label>E-mail</label>
                                        <md-icon class="material-icons">&#xE0BE;</md-icon>
                                        <!-- INPUT EMAIL-->
                                        <input type="email"
                                               ng-minlength="8" 
                                               md-maxlength="35"
                                               maxlength="40"
                                               placeholder="E-mail" md-no-asterisk
                                               ng-model="user.email" name="email" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePerfil.email.$error"
                                             ng-if='changePerfil.email.$dirty || changePerfil.email.$touched'>
                                            <div ng-message="email">Dirección de e-mail invalida.</div>
                                            <div ng-message="minlength">Dirección de e-mail demasiado corta.</div>
                                            <div ng-message="md-maxlength">Dirección de e-mail demasiado larga.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container><!-- FIN INPUT EMAIL-->
                                    <!--INPUT TELEFONO -->
                                    <div layout="row" style="max-height: 84px;">
                                        <!-- INPUT FECHA-->
                                        <md-input-container class="md-icon md-block" flex>
                                            <!-- LABEL FECHA-->
                                            <label>Fecha de nacimiento</label>
                                            <md-icon class="material-icons">&#xE916;</md-icon>
                                            <!-- INPUT FECHA-->
                                            <input ng-model="user.fechaNacimiento"
                                                   name="nacimiento" id="nacimientoDate"
                                                   type="date"
                                                   min="1950-01-01"
                                                   required ng-pattern="/^([0-9]{4})+([-]{1})+([0-9]{2})+([-]{1})+([0-9]{2})$/">
                                            <!-- MENSAJES-->
                                            <div ng-messages="changePerfil.nacimiento.$error"
                                                 ng-if='changePerfil.nacimiento.$dirty || changePerfil.nacimiento.$touched'>
                                                <div ng-message="date">Fecha de nacimiento invalida.</div>                            
                                                <div ng-message="min">Fecha de nacimiento minima 01-01-1950.</div>                            
                                                <div ng-message="max">Fecha de nacimiento maxima hoy.</div>                          
                                                <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                            </div>
                                        </md-input-container><!-- FIN INPUT FECHA-->
                                        <!-- INPUT TELEFONO-->
                                        <md-input-container class="md-icon md-block" flex>
                                            <!-- LABEL TELEFONO-->
                                            <label>Telefono</label>
                                            <md-icon class="material-icons">&#xE0CD;</md-icon>
                                            <!-- INPUT TELEFONO-->
                                            <input type="tel"
                                                   maxlength="10"
                                                   md-maxlength="10"
                                                   placeholder="Telefono"
                                                   ng-model="user.telefono" name="telefono" required/>
                                            <!-- MENSAJES-->
                                            <div ng-messages="changePerfil.telefono.$error"
                                                 ng-if='changePerfil.telefono.$dirty || changePerfil.telefono.$touched'>
                                                <div ng-message="tel">Número de telefono invalido.</div>
                                                <div ng-message="md-maxlenght">Número de telefono demasiado largo.</div>
                                                <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                            </div>
                                        </md-input-container><!-- FIN INPUT TELEFONO-->   
                                    </div>
                                    <!-- BOTONES -->
                                    <div flex style="text-align: center;">
                                        <!-- BOTON ACTUALIZAR-->
                                        <button ng-click="actualizarPerfil()"
                                                class="btn btn-success"
                                                ng-disabled="changePerfil.$invalid"
                                                >Guardar</button>
                                        <!-- BOTON SALIR-->
                                        <button type="button"
                                                class="btn btn-danger"
                                                style="width: 79px;"
                                                ui-sref="perfil">Salir</button>
                                    </div><!-- FIN BOTONES-->
                                </form>                                
                            </div> 
                        </md-content>
                    </md-tab><!--FIN TAB MODIFICAR USUARIO-->
                    <!-- TAB ACTUALIZAR FOTO PERFIL-->
                    <md-tab label="Cambiar foto">
                        <md-content layout-margin>
                            <div class="row" flex style="text-align: center;">
                                <!-- FORMULARIO ACTUALIZAR FOTO-->
                                <form name="fotoPerfil">
                                    <!-- IMAGEN DE PERFIL -->
                                    <img ng-src="data:image/JPEG;base64,{{user.imagen}}" 
                                         style="max-height: 400px; max-width: 400px; margin-top: 1%;">
                                    <!-- INPUT ARCHIVO -->
                                    <center flex>
                                        <input ngf-select 
                                               ng-model="fileUpload" name="file" ngf-pattern="'image/*'"
                                               ngf-accept="'image/*'"
                                               ngf-max-size="2MB" ngf-min-height="100" type="file"
                                               style="margin-bottom: 5%;" required/>
                                    </center>
                                    <!-- BOTON ACTUALIZAR FOTO -->
                                    <button ng-click="actualizarFoto(fileUpload)"
                                            ng-disabled="fotoPerfil.$invalid" 
                                            class="btn btn-success"
                                            style="">Guardar</button>
                                    <!-- BOTON SALIR -->
                                    <button type="button"
                                            class="btn btn-danger"
                                            style=" width: 79px;"
                                            ui-sref="perfil">Salir</button>
                                </form>
                            </div>
                        </md-content>
                    </md-tab><!--FIN TAB ACTUALIZAR FOTO PERFIL-->
                    <!-- TAB ACTUALIZAR CONTRASEÑA -->
                    <md-tab label="Cambiar contraseña">
                        <md-content class="md-padding">
                            <div class="col-lg-2"></div>
                            <div class="col-lg-8">
                                <!-- FORMULARIO ACTUALIZAR CONTRASEÑA -->
                                <form name="changePassword">
                                    <!-- INPUT CONTRASEÑA ACTUAL -->
                                    <md-input-container class="md-icon md-block">
                                        <!-- LABEL CONTRASEÑA ACTUAL-->
                                        <label>Contraseña actual</label>
                                        <md-icon class="material-icons">&#xE0DA;</md-icon>                                        
                                        <input type="password" 
                                               ng-minlength="8" 
                                               placeholder="Ingresa contraseña actual"
                                               ng-model="userPw.old" name="old" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePassword.old.$error"
                                             ng-if='changePassword.old.$dirty || changePassword.old.$touched'>
                                            <div ng-message="password">Contraseña invalida.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container><!-- FIN INPUT CONTRASEÑA ACTUAL -->
                                    <!-- INPUT CONTRASEÑA NUEVA -->
                                    <md-input-container class="md-icon md-block">
                                        <label>Contraseña nueva</label>
                                        <md-icon class="material-icons">&#xE0DA;</md-icon>
                                        <input type="password"
                                               ng-minlength="8"
                                               ng-pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$"
                                               pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).*$"
                                               placeholder="Ingresa contraseña nueva"
                                               ng-model="userPw.new" name="new" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePassword.new.$error"
                                             ng-if='changePassword.new.$dirty || changePassword.new.$touched'>
                                            <div ng-message="pattern">La contraseña debe contener al menos una mayuscula, una minuscula y un número.</div>
                                            <div ng-message="minlength">Contraseña demasiado corta.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container><!-- FIN INPUT CONTRASEÑA NUEVA-->
                                    <!-- INPUT REPETIR CONTRASEÑA NUEVA -->
                                    <md-input-container class="md-icon md-block">
                                        <!-- LABEL REPETIR CONTRASEÑA ACTUAL-->
                                        <label>Repetir contraseña</label>
                                        <md-icon class="material-icons">&#xE0DA;</md-icon>
                                        <input type="password"
                                               ng-minlength="8"
                                               placeholder="Repetir contraseña"
                                               ng-model="userPw.rep" name="rep" required/>
                                        <!-- MENSAJES-->
                                        <div ng-messages="changePassword.rep.$error"
                                             ng-if='changePassword.rep.$dirty || changePassword.rep.$touched'>
                                            <div ng-message="password">Contraseña invalida.</div>
                                            <div ng-message="minlength">Contraseña demasiado corta.</div>
                                            <div ng-message="required">Este campo no puede estar vacio.</div>                            
                                        </div>
                                    </md-input-container>
                                    <div flex style="margin-top: 10%; text-align: center;">
                                        <button ng-click="cambiarPassword()"
                                                class="btn btn-success" 
                                                style=""
                                                ng-disabled="changePassword.$invalid">Guardar</button>
                                        <button type="button"
                                                class="btn btn-danger"
                                                style=" width: 79px;"
                                                ui-sref="perfil">Salir</button>
                                    </div>
                                </form>
                            </div>                            
                            </form>
                        </md-content>
                    </md-tab>
                </md-tabs>                    
            </md-content>
        </div>
    </div>
</div>
<script>
    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //Enero es 0!
    var yyyy = today.getFullYear();
    if (dd < 10) {
        dd = '0' + dd;
    }
    if (mm < 10) {
        mm = '0' + mm;
    }

    today = yyyy + '-' + mm + '-' + dd;
    document.getElementById("nacimientoDate").setAttribute("max", today);
</script>